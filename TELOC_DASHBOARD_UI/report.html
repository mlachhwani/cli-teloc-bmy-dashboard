<!DOCTYPE html>
<html>
<head>
  <title>Personnel History Report</title>
  <style>
    body { font-family: sans-serif; padding: 30px; background: #f8fafc; color: #1e293b; }
    .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
    h1 { border-bottom: 3px solid #38bdf8; padding-bottom: 10px; margin: 0 0 20px 0; text-transform: uppercase; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th { text-align: left; padding: 12px; background: #f1f5f9; border-bottom: 2px solid #cbd5e1; }
    td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
    .no-print { margin-bottom: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <button class="no-print" onclick="window.print()">Print PDF</button>
    <h1 id="userName">Loading...</h1>
    <p id="userType" style="color: #64748b; font-weight: bold;"></p>
    <table>
      <thead>
        <tr><th>Analysis Date</th><th>Work Date</th><th>Loco No</th><th>Section</th><th>Irregularity</th></tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="5" style="text-align:center">Fetching history...</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbxMxS6vLHuxOzAios9j6BAEt8g8sGTb9QMROkwn4F-WhXuuysVUnq2FZPddJk-nJw1kEg/exec"; // Wahi URL yahan bhi daalein
    const params = new URLSearchParams(window.location.search);
    const name = params.get('name');
    const type = params.get('type');

    document.getElementById('userName').innerText = name;
    document.getElementById('userType').innerText = "Category: " + type + " Monitoring History";

    async function load() {
      const res = await fetch(`${API}?getReport=true&name=${encodeURIComponent(name)}&type=${type}`);
      const data = await res.json();
      const body = document.getElementById('tableBody');
      if (data.length === 0) {
        body.innerHTML = '<tr><td colspan="5" style="text-align:center">No records found for this person this month.</td></tr>';
        return;
      }
      body.innerHTML = data.map(row => `
        <tr><td>${row.date}</td><td>${row.work}</td><td>${row.loco}</td><td>${row.section}</td><td>${row.remark}</td></tr>
      `).join('');
    }
    load();
  </script>
</body>
</html>
