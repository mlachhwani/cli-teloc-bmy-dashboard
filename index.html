<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SECR | TELOC EYE PRO</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --rail-blue: #003399; --rail-red: #d11212; --bg: #f0f4f8; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
    
    /* Header: Double Size */
    .master-header { display: flex; align-items: center; justify-content: center; background: white; padding: 25px; border-bottom: 6px solid var(--rail-red); border-radius: 15px; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .logo-left { width: 140px; height: 140px; margin-right: 40px; }
    .header-titles h1 { font-size: 3rem; color: var(--rail-blue); margin: 0; font-weight: 900; }
    .header-titles h2 { font-size: 1.8rem; color: #444; margin: 5px 0 0 0; font-weight: 600; }

    /* KPI Cards */
    .kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
    .card { background: white; padding: 20px; border-radius: 15px; text-align: center; border-top: 5px solid var(--rail-blue); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .card h3 { font-size: 0.85rem; color: #555; margin-bottom: 15px; height: 35px; text-transform: uppercase; }
    .val { font-size: 2.2rem; font-weight: 800; margin-bottom: 15px; }
    .btn-group { display: flex; gap: 8px; }
    .btn { flex: 1; padding: 8px 5px; border: none; border-radius: 4px; cursor: pointer; font-weight: 700; font-size: 0.65rem; color: white; transition: 0.2s; }
    .btn-rep { background: #0284c7; }
    .btn-vio { background: #e11d48; }
    .btn:hover { filter: brightness(1.2); }

    /* Layout & Graphs */
    .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    .graph-card { background: white; padding: 15px; border-radius: 12px; height: 200px; border: 1px solid #ddd; }
    .graph-card h4 { margin: 0 0 10px 0; font-size: 0.75rem; color: #666; text-transform: uppercase; }

    /* CLI/LP Search Boxes */
    .search-row { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
    .search-box { 
      height: 220px; border-radius: 20px; background-size: cover; background-position: center;
      position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; 
      color: white; border: 4px solid white; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .search-box::after { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.6); }
    .search-box * { z-index: 5; position: relative; }
    .search-box h2 { font-size: 1.8rem; margin: 0; font-weight: 900; }
    .search-box p { font-size: 1rem; margin-top: 5px; letter-spacing: 2px; }
    .search-input { width: 70%; padding: 12px; border-radius: 8px; border: none; margin-top: 15px; font-weight: 600; }

    .cli-bg { background-image: url('https://raw.githubusercontent.com/Anand-CLI/TELOC_EYE/main/WAG9.jpg'); } /* Replace with real WAG9 path */
    .lp-bg { background-image: url('https://raw.githubusercontent.com/Anand-CLI/TELOC_EYE/main/MEMU.jpg'); }

    .watermark { position: fixed; bottom: 10px; right: 20px; font-size: 0.7rem; font-weight: 800; color: #94a3b8; letter-spacing: 1px; }
  </style>
</head>
<body>

  <div class="master-header">
    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/4/41/South_East_Central_Railway_Logo.png/220px-South_East_Central_Railway_Logo.png" class="logo-left">
    <div class="header-titles">
      <h1>SOUTH EAST CENTRAL RAILWAY</h1>
      <h2>ELECTRICAL (OP) DEPARTMENT, RAIPUR DIVISION</h2>
    </div>
    <input type="date" id="datePicker" onchange="loadData()" style="margin-left:auto; padding:10px; border-radius:8px;">
  </div>

  <div class="kpi-row">
    <div class="card"><h3>Speedometer Data Analysis</h3><div id="v1" class="val">0</div>
      <div class="btn-group"><button class="btn btn-rep" onclick="openTable('SPM', false)">REPORT</button><button class="btn btn-vio" onclick="openTable('SPM', true)">VIOLATION</button></div>
    </div>
    <div class="card"><h3>CVVRS Data Analysis</h3><div id="v2" class="val">0</div>
      <div class="btn-group"><button class="btn btn-rep" onclick="openTable('CVVRS', false)">REPORT</button><button class="btn btn-vio" onclick="openTable('CVVRS', true)">VIOLATION</button></div>
    </div>
    <div class="card"><h3>TELOC Cell Analysis</h3><div id="v4" class="val">0</div>
      <div class="btn-group"><button class="btn btn-rep" onclick="openTable('TELOC', false)">REPORT</button><button class="btn btn-vio" onclick="openTable('TELOC', true)">VIOLATION</button></div>
    </div>
    <div class="card"><h3>Bulk Analysis Progress</h3><div id="v3" class="val">0</div>
      <div class="btn-group"><button class="btn btn-rep" onclick="openTable('BULK', false)">REPORT</button><button class="btn btn-vio" onclick="openTable('BULK', true)">VIOLATION</button></div>
    </div>
  </div>

  <div class="main-grid">
    <div class="graph-card"><h4>SPM Analysis Progress</h4><canvas id="c1"></canvas></div>
    <div class="graph-card"><h4>CVVRS Analysis Progress</h4><canvas id="c2"></canvas></div>
    <div class="graph-card"><h4>TELOC Cell Progress</h4><canvas id="c4"></canvas></div>
    <div class="graph-card"><h4>Bulk Analysis Progress</h4><canvas id="c3"></canvas></div>
  </div>

  <div class="search-row">
    <div class="search-box cli-bg">
      <h2>CHIEF LOCO INSPECTOR</h2><p>MONITORING</p>
      <input type="text" list="cliL" class="search-input" placeholder="Search CLI Name..." onchange="goSearch(this.value, 'CLI')">
      <datalist id="cliL"></datalist>
    </div>
    <div class="search-box lp-bg">
      <h2>LOCO PILOTS</h2><p>PERFORMANCE</p>
      <input type="text" list="lpL" class="search-input" placeholder="Search LP Name..." onchange="goSearch(this.value, 'LP')">
      <datalist id="lpL"></datalist>
    </div>
  </div>

  <div class="watermark">DEVELOPED BY CLI/TELOC/BMY</div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbwzR1uFmdCB-J_wVDHm2K8tOw0h-4lZ14n5-3zNowCmJdfOu1O89wyO96NnOATCAVnROQ/exec";
    let charts = {};

    async function loadData() {
      const date = document.getElementById('datePicker').value;
      const res = await fetch(`${API}?date=${date}`);
      const d = await res.json();
      
      document.getElementById('v1').innerText = d.snapshot.spm_today;
      document.getElementById('v2').innerText = d.snapshot.cvvrs_today;
      document.getElementById('v3').innerText = d.snapshot.bulk_today;
      document.getElementById('v4').innerText = d.snapshot.violations;

      const opt = { type: 'bar', barThickness: 8, borderRadius: 5 };
      renderChart('c1', d.trends.dates, d.trends.spm, '#0284c7', opt);
      renderChart('c2', d.trends.dates, d.trends.cvvrs, '#10b981', opt);
      renderChart('c3', d.trends.dates, d.trends.bulk, '#f59e0b', opt);
      renderChart('c4', d.trends.dates, d.trends.teloc, '#e11d48', opt);

      document.getElementById('cliL').innerHTML = d.cli_list.map(n => `<option value="${n}">`).join('');
      document.getElementById('lpL').innerHTML = d.lp_list.map(n => `<option value="${n}">`).join('');
    }

    function renderChart(id, x, y, color, opt) {
      if(charts[id]) charts[id].destroy();
      charts[id] = new Chart(document.getElementById(id), {
        type: opt.type,
        data: { labels: x, datasets: [{ data: y, backgroundColor: color, ...opt }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, 
          scales: { x: { grid: { display: false }, ticks: { minRotation: 0, maxRotation: 0 } }, y: { beginAtZero: true } } }
      });
    }

    function openTable(type, onlyVio) {
      const d = document.getElementById('datePicker').value;
      window.open(`report.html?action=fullTable&date=${d}&type=${type}&onlyViolations=${onlyVio}`, '_blank');
    }

    function goSearch(name, role) {
      if(!name) return;
      window.open(`report.html?action=search&name=${encodeURIComponent(name)}&role=${role}`, '_blank');
    }

    document.getElementById('datePicker').value = new Date().toISOString().split('T')[0];
    loadData();
  </script>
</body>
</html>
