<!DOCTYPE html>
<html>
<head>
  <title>TELOC EYE PRO DASHBOARD</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    .header { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; background: #111827; }
    .kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 15px; }
    .card { background: var(--card); padding: 15px; border-radius: 8px; border-top: 4px solid var(--accent); text-align: center; }
    .graph-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 15px; flex-grow: 1; }
    .chart-container { background: var(--card); border-radius: 8px; padding: 10px; height: 210px; }
    .search-row { height: 100px; background: #111827; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #334155; }
    input { background: #334155; border: 1px solid var(--accent); color: white; padding: 12px; border-radius: 25px; width: 280px; text-align: center; }
  </style>
</head>
<body>
  <div class="header">
    <h2 style="margin:0; color:var(--accent)">TELOC EYE ANALYTICS</h2>
    <input type="date" id="dateSelect" onchange="init()" style="width: auto; border-radius: 5px;">
  </div>

  <div class="kpi-row">
    <div class="card">SPM TODAY<div id="v1" style="font-size:1.5rem; font-weight:bold">0</div></div>
    <div class="card">CVVRS TODAY<div id="v2" style="font-size:1.5rem; font-weight:bold">0</div></div>
    <div class="card">BULK EVENTS<div id="v3" style="font-size:1.5rem; font-weight:bold">0</div></div>
    <div class="card" style="border-top-color:#ef4444">VIOLATIONS<div id="v4" style="font-size:1.5rem; font-weight:bold">0</div></div>
  </div>

  <div class="graph-grid">
    <div class="chart-container"><canvas id="c1"></canvas></div>
    <div class="chart-container"><canvas id="c2"></canvas></div>
    <div class="chart-container"><canvas id="c3"></canvas></div>
    <div class="chart-container"><canvas id="c4"></canvas></div>
  </div>

  <div class="search-row">
    <input list="cliL" id="cliI" placeholder="Search CLI (e.g. MU...)" onchange="go(this.value, 'CLI')"><datalist id="cliL"></datalist>
    <input list="lpL" id="lpI" placeholder="Search LP (e.g. RA...)" onchange="go(this.value, 'LP')"><datalist id="lpL"></datalist>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbxMxS6vLHuxOzAios9j6BAEt8g8sGTb9QMROkwn4F-WhXuuysVUnq2FZPddJk-nJw1kEg/exec"; // Yahan apna URL paste karein
    let charts = {};

    async function init() {
      const d = document.getElementById('dateSelect').value;
      const res = await fetch(`${API}?date=${d}`);
      const data = await res.json();
      document.getElementById('v1').innerText = data.snapshot.spm_today;
      document.getElementById('v2').innerText = data.snapshot.cvvrs_today;
      document.getElementById('v3').innerText = data.snapshot.bulk_today;
      document.getElementById('v4').innerText = data.snapshot.violations;
      
      document.getElementById('cliL').innerHTML = data.cli_list.map(n => `<option value="${n}">`).join('');
      document.getElementById('lpL').innerHTML = data.lp_list.map(n => `<option value="${n}">`).join('');

      render('c1', 'SPM Trend', data.trends.dates, data.trends.spm, '#38bdf8');
      render('c2', 'CVVRS Trend', data.trends.dates, data.trends.cvvrs, '#10b981');
      render('c3', 'Bulk Trend', data.trends.dates, data.trends.bulk, '#f59e0b');
      render('c4', 'Violations Trend', data.trends.dates, data.trends.teloc, '#ef4444');
    }

    function render(id, label, x, y, color) {
      if(charts[id]) charts[id].destroy();
      charts[id] = new Chart(document.getElementById(id), {
        type: 'line',
        data: { labels: x, datasets: [{ label: label, data: y, borderColor: color, tension: 0.3, fill: true, backgroundColor: color+'11' }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { tooltip: { enabled: true } } }
      });
    }

    function go(v, t) {
      if(!v) return;
      window.open(`report.html?name=${encodeURIComponent(v)}&type=${t}`, '_blank');
      document.getElementById('cliI').value = ''; document.getElementById('lpI').value = '';
    }
    document.getElementById('dateSelect').value = "2026-01-02";
    init();
  </script>
</body>
</html>
