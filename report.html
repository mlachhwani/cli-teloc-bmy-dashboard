<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: sans-serif; background: #f1f5f9; padding: 20px; }
    .container { background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: auto; max-width: 1200px; margin: auto; }
    .header { background: #1e3a8a; color: white; padding: 20px; text-align: center; }
    .header.violation { background: #be123c; }
    table { width: 100%; border-collapse: collapse; min-width: 800px; }
    th { background: #f8fafc; padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0; font-size: 11px; text-transform: uppercase; }
    td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
    tr:nth-child(even) { background: #fcfcfc; }
  </style>
</head>
<body>
  <div class="container">
    <div id="h" class="header"><h1>DATA REPORT</h1><p id="sub"></p></div>
    <table id="tbl">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
  <script>
    const API = "https://script.google.com/macros/s/AKfycbwzR1uFmdCB-J_wVDHm2K8tOw0h-4lZ14n5-3zNowCmJdfOu1O89wyO96NnOATCAVnROQ/exec";
    const p = new URLSearchParams(window.location.search);
    
    async function load() {
      const url = `${API}?${p.toString()}`;
      const res = await fetch(url);
      const data = await res.json();
      
      if(p.get('action') === "fullTable") {
        if(p.get('onlyViolations') === "true") document.getElementById('h').classList.add('violation');
        document.getElementById('sub').innerText = `${p.get('type')} - DATE: ${p.get('date')}`;
        document.getElementById('thead').innerHTML = `<tr>${data.headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
        document.getElementById('tbody').innerHTML = data.rows.map(r => `<tr>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('');
      } else {
        document.getElementById('sub').innerText = `NAME: ${p.get('name')} (${p.get('role')})`;
        document.getElementById('thead').innerHTML = `<tr><th>DATE</th><th>SOURCE</th><th>LOCO</th><th>SECTION</th><th>REMARKS</th></tr>`;
        document.getElementById('tbody').innerHTML = data.map(r => `<tr><td>${r.date}</td><td><b>${r.type}</b></td><td>${r.loco}</td><td>${r.section}</td><td>${r.remark}</td></tr>`).join('');
      }
    }
    load();
  </script>
</body>
</html>
