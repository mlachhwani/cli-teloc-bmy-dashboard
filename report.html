<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: sans-serif; background: #f1f5f9; padding: 20px; }
    .container { background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: auto; max-width: 1200px; margin: auto; }
    .header { background: #1e3a8a; color: white; padding: 15px; text-align: center; }
    .header.violation { background: #be123c; }
    .info-bar { display: flex; justify-content: space-between; padding: 10px 20px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; font-weight: bold; color: #475569; }
    table { width: 100%; border-collapse: collapse; }
    th { background: #f1f5f9; padding: 10px; text-align: left; font-size: 11px; }
    td { padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }
    @media print { .no-print { display: none; } }
  </style>
</head>
<body>
  <div class="container">
    <div id="h" class="header"><h1 id="title">REPORT</h1></div>
    <div class="info-bar">
      <span id="sub">--</span>
      <span id="dt">DATE: --</span>
      <button class="no-print" onclick="window.print()">Print PDF</button>
    </div>
    <table>
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
  <script>
    const API = "https://script.google.com/macros/s/AKfycbwYZa4_6mI0Tycm8s8qztgWuidjvlWC54Ihk-8PYMMulKSoJLojTpJuK3WyxluK-2bbUw/exec";
    const p = new URLSearchParams(window.location.search);
    
    async function load() {
      const res = await fetch(`${API}?${p.toString()}`);
      const data = await res.json();
      
      if(p.get('action') === "fullTable") {
        document.title = p.get('type') + " Report";
        if(p.get('onlyViolations') === "true") {
           document.getElementById('h').classList.add('violation');
           document.getElementById('title').innerText = "VIOLATION ANALYSIS";
        } else {
           document.getElementById('title').innerText = "GENERAL ANALYSIS";
        }
        document.getElementById('sub').innerText = "SOURCE: " + p.get('type');
        document.getElementById('dt').innerText = "SELECTED DATE: " + p.get('date');
        document.getElementById('thead').innerHTML = `<tr>${data.headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
        document.getElementById('tbody').innerHTML = data.rows.map(r => `<tr>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('');
      } else {
        document.getElementById('title').innerText = "PERSONNEL PERFORMANCE";
        document.getElementById('sub').innerText = p.get('name') + " (" + p.get('role') + ")";
        document.getElementById('dt').innerText = "GENERATED ON: " + new Date().toLocaleDateString();
        document.getElementById('thead').innerHTML = `<tr><th>DATE</th><th>SOURCE</th><th>LOCO</th><th>SECTION</th><th>REMARKS</th></tr>`;
        document.getElementById('tbody').innerHTML = data.map(r => `<tr><td>${r.date}</td><td><b>${r.type}</b></td><td>${r.loco}</td><td>${r.section}</td><td>${r.remark}</td></tr>`).join('');
      }
    }
    load();
  </script>
</body>
</html>
