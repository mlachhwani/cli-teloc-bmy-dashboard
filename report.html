<!DOCTYPE html>
<html>
<head>
  <title>SECR REPORT</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8fafc; }
    .header { background: #003399; color: white; padding: 15px; display: flex; justify-content: space-between; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; background: white; margin-top: 15px; }
    th { background: #f1f5f9; padding: 10px; text-align: left; border-bottom: 2px solid #ddd; font-size: 0.8rem; position: sticky; top: 0; }
    td { padding: 10px; border-bottom: 1px solid #eee; font-size: 0.8rem; }
  </style>
</head>
<body>
  <div class="header">
    <h3 id="rTitle">Report</h3>
    <input type="text" id="f" placeholder="Quick Filter..." onkeyup="filter()" style="padding:8px; border-radius:4px; border:none; width:200px;">
  </div>
  <div id="content"></div>
  <script>
    const API = "https://script.google.com/macros/s/AKfycbzygyqJ3GdfZ5lSzqorAkfzDCn28OjtodqMFd9Gaiu-G1w7bo9ql-6FISp40FUVYFsDvA/exec";
    const p = new URLSearchParams(window.location.search);
    async function load() {
      const res = await fetch(`${API}?action=fullTable&type=${p.get('type')}&date=${p.get('date')}&onlyViolations=${p.get('onlyViolations')}`);
      let data = await res.json();
      const s = p.get('search');
      if(s) { let h = data[0]; data = [h, ...data.slice(1).filter(r => r.join(' ').toLowerCase().includes(s.toLowerCase()))]; }
      let h = '<table><thead><tr>';
      data[0].forEach(c => h += `<th>${c}</th>`);
      h += '</tr></thead><tbody id="tb">';
      data.slice(1).forEach(r => { h += '<tr>'; r.forEach(c => h += `<td>${c}</td>`); h += '</tr>'; });
      document.getElementById('content').innerHTML = h + '</tbody></table>';
      document.getElementById('rTitle').innerText = p.get('type') + " Analysis";
    }
    function filter() {
      let v = document.getElementById('f').value.toLowerCase();
      document.querySelectorAll('#tb tr').forEach(r => r.style.display = r.innerText.toLowerCase().includes(v) ? '' : 'none');
    }
    window.onload = load;
  </script>
</body>
</html>
