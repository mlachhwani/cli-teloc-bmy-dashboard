<!DOCTYPE html>
<html>
<head>
  <title>SECR Report</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8fafc; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th { background: #003399; color: white; padding: 12px; text-align: left; position: sticky; top: 0; }
    td { padding: 10px; border: 1px solid #eee; font-size: 0.85rem; }
    tr:nth-child(even) { background: #f9f9f9; }
  </style>
</head>
<body>
  <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
    <h2 id="title">Report</h2>
    <input type="text" id="tableFilter" placeholder="Filter current table..." onkeyup="filterTable()" style="padding:10px; width:250px;">
  </div>
  <div id="content"></div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbzGqnjzjOLIaWH7Ot4iBUWspnDa9GltYhLOmMUB7pJSnOHLPtnbhxyxjl2kows3EahHqA/exec";
    const p = new URLSearchParams(window.location.search);

    async function load() {
      const type = p.get('type');
      const search = p.get('search');
      let url = `${API}?action=fullTable&type=${type}&date=${p.get('date')}&onlyViolations=${p.get('onlyViolations')}`;
      
      const res = await fetch(url);
      let data = await res.json();

      if(search) {
        let header = data[0];
        data = [header, ...data.slice(1).filter(r => r.join(' ').toLowerCase().includes(search.toLowerCase()))];
      }

      let h = '<table><thead><tr>';
      data[0].forEach(c => h += `<th>${c}</th>`);
      h += '</tr></thead><tbody id="tbody">';
      data.slice(1).forEach(r => {
        h += '<tr>';
        r.forEach(c => h += `<td>${c}</td>`);
        h += '</tr>';
      });
      document.getElementById('content').innerHTML = h + '</tbody></table>';
      document.getElementById('title').innerText = `${type} Report`;
    }

    function filterTable() {
      let val = document.getElementById('tableFilter').value.toLowerCase();
      let rows = document.querySelectorAll('#tbody tr');
      rows.forEach(r => r.style.display = r.innerText.toLowerCase().includes(val) ? '' : 'none');
    }
    window.onload = load;
  </script>
</body>
</html>
